{% extends 'base.html' %}

{% block title %}Investments - Finance Tracker{% endblock %}

{% block content %}
  <h2 class="mb-3">Manage Investments</h2>

  <div class="row">
    <div class="col-md-5">
      <div class="card p-3 mb-3">
        <h5>Add New Investment</h5>
        <form id="investmentForm">
          <div class="mb-2">
            <label class="form-label" for="type">Investment Type</label>
            <input class="form-control" type="text" id="type" name="type" placeholder="e.g., stocks, crypto" required>
          </div>
          <div class="mb-2">
            <label class="form-label" for="amount">Amount Invested</label>
            <input class="form-control" type="number" id="amount" name="amount" step="0.01" required>
          </div>
          <div class="mb-2">
            <label class="form-label" for="currency">Currency</label>
            <select id="currency" name="currency" class="form-select"></select>
          </div>
          <div class="mb-2">
            <label class="form-label" for="returns">Expected Returns</label>
            <input class="form-control" type="text" id="returns" name="returns">
          </div>
          <div class="mb-2">
            <label class="form-label" for="note">Note</label>
            <textarea class="form-control" id="note" name="note" rows="2"></textarea>
          </div>
          <button class="btn btn-success">Add Investment</button>
        </form>
      </div>
    </div>

    <div class="col-md-7">
      <div class="card p-3">
        <h5>Investment List</h5>
        <div id="investmentsList">Loading investments...</div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
async function loadInvestments() {
  try {
    const response = await fetch('/api/investments');
    const investments = await response.json();
    if (investments.length === 0) { document.getElementById('investmentsList').innerHTML = '<p>No investments recorded yet</p>'; return; }
    let html = '<table class="table"><thead><tr><th>Type</th><th>Amount</th><th>Expected Returns</th><th>Note</th><th>Date</th><th>Action</th></tr></thead><tbody>';
    investments.forEach((investment, index) => { const cur = investment.currency || 'USD'; html += `<tr><td>${investment.type}</td><td>${cur} ${Number(investment.amount).toFixed(2)}</td><td>${investment.returns}</td><td>${investment.note}</td><td>${investment.date}</td><td><button class="btn btn-danger btn-sm" onclick="deleteInvestment(${index})">Delete</button></td></tr>`; });
    html += '</tbody></table>';
    document.getElementById('investmentsList').innerHTML = html;
  } catch (error) { console.error('Error loading investments:', error); document.getElementById('investmentsList').innerHTML = '<p>Error loading investments</p>'; }
}

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('investmentForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = { type: document.getElementById('type').value, amount: document.getElementById('amount').value, currency: document.getElementById('currency').value, returns: document.getElementById('returns').value, note: document.getElementById('note').value };
    try {
      const response = await fetch('/api/investments', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(formData) });
      if (response.ok) { document.getElementById('investmentForm').reset(); loadInvestments(); alert('Investment added successfully!'); } else { alert('Error adding investment'); }
    } catch (error) { console.error('Error:', error); alert('Error adding investment'); }
  });
  loadInvestments();

  window.deleteInvestment = async function(index) { if (!confirm('Are you sure?')) return; try { const response = await fetch(`/api/investments/${index}`, { method: 'DELETE' }); if (response.ok) { loadInvestments(); alert('Investment deleted successfully!'); } else { alert('Error deleting investment'); } } catch (e) { console.error('Error:', e); alert('Error deleting investment'); } };

  async function loadCurrencies() { try { const res = await fetch('/api/currencies'); const data = await res.json(); const sel = document.getElementById('currency'); data.symbols.forEach(s => { const opt = document.createElement('option'); opt.value = s; opt.text = s; sel.appendChild(opt); }); if (data.symbols.includes('USD')) sel.value = 'USD'; } catch (e) { console.warn('Could not load currencies', e); const sel = document.getElementById('currency'); ['USD','EUR','INR'].forEach(s => { const opt = document.createElement('option'); opt.value=s; opt.text=s; sel.appendChild(opt);}); } }

  loadCurrencies();
});
</script>
{% endblock %}
